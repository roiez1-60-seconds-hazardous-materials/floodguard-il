<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FloodGuard IL — מערכת התרעה להצפות</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="style.css"/>
</head>
<body>

<header id="header">
  <div class="brand">🌧️ <strong>Flood<span>Guard</span> IL</strong></div>
  <div class="status"><div class="pulse-dot"></div><span id="statusMsg">מערכת פעילה</span><span id="clock"></span></div>
</header>

<div id="app">
  <div id="mapWrap">
    <div id="map"></div>

    <div id="mapBtns">
      <button onclick="toggleSrc('ims')" id="btnIms">📡 שמ"ט</button>
      <button onclick="toggleSrc('rainviewer')" id="btnWindy">🌧️ RainViewer</button>
      <button onclick="analyze()" id="btnRun">⚡ נתח</button>
      <button onclick="toggleAuto()" id="btnAuto">🔄 אוטומטי</button>
      <button onclick="refreshRadar()" id="btnRefresh" style="display:none">🔃 רענן</button>
    </div>
    <div id="legend">
      <b>מקרא</b>
      <div><span class="dot" style="background:#22c55e"></span> תקין</div>
      <div><span class="dot" style="background:#f59e0b"></span> 15-25 מ"מ/שעה</div>
      <div><span class="dot" style="background:#ef4444"></span> 25-40 מ"מ/שעה</div>
      <div><span class="dot" style="background:#dc2626"></span> 40+ מ"מ/שעה</div>
    </div>
    <!-- Radar timestamp display -->
    <div id="radarTime" style="display:none;position:absolute;top:10px;right:10px;z-index:500;background:var(--card);border:1px solid var(--brd);border-radius:8px;padding:6px 10px;font-size:11px;color:var(--tx2);">
      🕐 מכ"מ: <span id="radarTimeVal">--</span>
    </div>
  </div>

  <div id="sidebar">
    <div id="tabs">
      <button class="tab on" onclick="showTab('alerts',this)">🔔 התראות</button>
      <button class="tab" onclick="showTab('list',this)">🏘️ יישובים</button>
      <button class="tab" onclick="showTab('upload',this)">📤 העלאה</button>
    </div>
    <div id="panel">
      <div id="p-alerts" class="pane on">
        <div id="counters">
          <div class="cnt cw"><div id="cntM" class="cnt-n">0</div><div class="cnt-l">בינוני</div></div>
          <div class="cnt cd"><div id="cntH" class="cnt-n">0</div><div class="cnt-l">חזק</div></div>
          <div class="cnt ce"><div id="cntE" class="cnt-n">0</div><div class="cnt-l">כבד מאוד</div></div>
        </div>
        <div id="alertCards">
          <p class="hint">לחץ "⚡ נתח" להפעלת ניתוח מכ"מ</p>
        </div>
      </div>
      <div id="p-list" class="pane">
        <input type="text" id="search" placeholder="🔍 חפש יישוב..." oninput="filterList()">
        <div id="settCards"></div>
      </div>
      <div id="p-upload" class="pane">
        <p class="hint">העלה תמונת מכ"מ גשם לניתוח ידני</p>
        <div style="display:flex;gap:6px;margin-bottom:8px;">
          <button onclick="setUploadSrc('ims')" class="srcBtn on" id="srcIms">שמ"ט</button>
          <button onclick="setUploadSrc('govmap')" class="srcBtn" id="srcGov">GovMap</button>
          <button onclick="setUploadSrc('rainviewer')" class="srcBtn" id="srcRv">RainViewer</button>
        </div>
        <div id="dropZone" onclick="document.getElementById('fileIn').click()">
          📤 לחץ להעלאת תמונה
        </div>
        <input type="file" id="fileIn" accept="image/*" style="display:none" onchange="onUpload(event)">
        <canvas id="cvs" style="display:none"></canvas>
        <div id="uploadRes"></div>
      </div>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="app.js"></script>
</body>
</html>
